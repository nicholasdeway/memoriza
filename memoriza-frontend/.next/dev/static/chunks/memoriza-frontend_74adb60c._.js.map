{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/memoriza/codigo-fonte/memoriza-frontend/components/ui/sonner.tsx"],"sourcesContent":["'use client'\n\nimport type React from 'react'\nimport { useTheme } from 'next-themes'\nimport { Toaster as Sonner, type ToasterProps } from 'sonner'\n\nconst Toaster = (props: ToasterProps) => {\n  const { theme = 'system' } = useTheme()\n\n  const { toastOptions, ...rest } = props\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps['theme']}\n      closeButton\n      position=\"top-right\"\n      {...rest}\n      toastOptions={{\n        ...toastOptions,\n        unstyled: true,\n        classNames: {\n          ...(toastOptions?.classNames ?? {}),\n          toast: [\n            \"relative flex w-full max-w-[380px] items-start gap-3\",\n            \"rounded-xl border bg-primary border-zinc-800 text-zinc-50\",\n            \"px-4 py-3 shadow-xl\",\n            \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n            \"data-[state=open]:fade-in-0 data-[state=closed]:fade-out-0\",\n            \"data-[state=open]:slide-in-from-right-3 data-[state=closed]:slide-out-to-right-3\",\n            toastOptions?.classNames?.toast ?? \"\",\n          ].join(\" \"),\n          title: [\n            \"font-semibold text-[15px]\",\n            toastOptions?.classNames?.title ?? \"\",\n          ].join(\" \"),\n          description: [\n            \"text-sm text-zinc-300\",\n            toastOptions?.classNames?.description ?? \"\",\n          ].join(\" \"),\n          icon: [\n            \"mt-0.5 h-4 w-4 text-zinc-200\",\n            toastOptions?.classNames?.icon ?? \"\",\n          ].join(\" \"),\n          closeButton: [\n            \"!absolute !top-3 !right-3 !left-auto !transform-none\",\n            \"inline-flex h-6 w-6 items-center justify-center\",\n            \"!rounded-md !border !border-zinc-700 !bg-zinc-900/80\",\n            \"!text-white\",\n            \"hover:!bg-white hover:!text-zinc-900\",\n            \"transition-colors duration-200 ease-in-out\",\n            toastOptions?.classNames?.closeButton ?? \"\",\n          ].join(\" \"),\n        },\n      }}\n      className=\"toaster group\"\n      style={\n        {\n          '--normal-bg': 'var(--popover)',\n          '--normal-text': 'var(--popover-foreground)',\n          '--normal-border': 'var(--border)',\n        } as React.CSSProperties\n      }\n    />\n  )\n}\n\nexport { Toaster }"],"names":[],"mappings":";;;;;AAGA;AACA;;;AAJA;;;AAMA,MAAM,UAAU,CAAC;;IACf,MAAM,EAAE,QAAQ,QAAQ,EAAE,GAAG,IAAA,uLAAQ;IAErC,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,GAAG;IAElC,qBACE,qNAAC,8KAAM;QACL,OAAO;QACP,WAAW;QACX,UAAS;QACR,GAAG,IAAI;QACR,cAAc;YACZ,GAAG,YAAY;YACf,UAAU;YACV,YAAY;gBACV,GAAI,cAAc,cAAc,CAAC,CAAC;gBAClC,OAAO;oBACL;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA,cAAc,YAAY,SAAS;iBACpC,CAAC,IAAI,CAAC;gBACP,OAAO;oBACL;oBACA,cAAc,YAAY,SAAS;iBACpC,CAAC,IAAI,CAAC;gBACP,aAAa;oBACX;oBACA,cAAc,YAAY,eAAe;iBAC1C,CAAC,IAAI,CAAC;gBACP,MAAM;oBACJ;oBACA,cAAc,YAAY,QAAQ;iBACnC,CAAC,IAAI,CAAC;gBACP,aAAa;oBACX;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA,cAAc,YAAY,eAAe;iBAC1C,CAAC,IAAI,CAAC;YACT;QACF;QACA,WAAU;QACV,OACE;YACE,eAAe;YACf,iBAAiB;YACjB,mBAAmB;QACrB;;;;;;AAIR;GA1DM;;QACyB,uLAAQ;;;KADjC"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///E:/memoriza/codigo-fonte/memoriza-frontend/lib/auth-context.tsx"],"sourcesContent":["\"use client\";\n\nimport React,\n{\n  createContext,\n  useContext,\n  useEffect,\n  useState,\n  useCallback,\n  useMemo,\n} from \"react\";\n\nconst API_BASE_URL =\n  process.env.NEXT_PUBLIC_API_BASE_URL ?? \"https://localhost:7105\";\n\ntype DecodedToken = {\n  id?: string;\n  email?: string;\n  firstName?: string;\n  lastName?: string;\n  fullName?: string;\n  userGroupId?: string;\n  employeeGroupId?: string;        // ← grupo personalizado para funcionários\n  isAdmin?: string | boolean;\n  authProvider?: string;\n  phone?: string;\n  // campos que vamos popular dinamicamente\n  modules?: string[];             // ← módulos permitidos (ex: [\"products\", \"employees\"])\n  groupPermissions?: any[];       // ← permissões completas vindas do grupo (opcional)\n  [key: string]: unknown;\n};\n\ntype LoginResult = { success: true } | { success: false; error?: string };\ntype RegisterResult = { success: true } | { success: false; error?: string };\n\ntype AuthContextValue = {\n  token: string | null;\n  user: DecodedToken | null;\n  isAdmin: boolean;\n  login: (identifier: string, password: string) => Promise<LoginResult>;\n  register: (input: {\n    firstName: string;\n    lastName: string;\n    email: string;\n    password: string;\n    confirmPassword: string;\n    phone?: string;\n  }) => Promise<RegisterResult>;\n  loginWithToken: (jwt: string) => void;\n  logout: () => void;\n  updateUserFromProfile: (data: {\n    firstName?: string;\n    lastName?: string;\n    email?: string;\n    phone?: string;\n  }) => void;\n  isLoading: boolean;\n};\n\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined);\n\n/* ======================================================\n   Decodificação do JWT (com correção de padding)\n====================================================== */\nfunction decodeJwt(token: string): DecodedToken | null {\n  try {\n    const payload = token.split(\".\")[1];\n    if (!payload) return null;\n\n    let base64 = payload.replace(/-/g, \"+\").replace(/_/g, \"/\");\n\n    // padding faltante\n    const pad = base64.length % 4;\n    if (pad === 2) base64 += \"==\";\n    else if (pad === 3) base64 += \"=\";\n\n    // Decodifica Base64 para bytes\n    const binaryString = atob(base64);\n    \n    // Converte bytes para UTF-8 corretamente\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n    \n    // Decodifica UTF-8\n    const json = new TextDecoder(\"utf-8\").decode(bytes);\n    return JSON.parse(json);\n  } catch {\n    return null;\n  }\n}\n\n/* ======================================================\n   Normalização do usuário (nome completo / provider)\n====================================================== */\nfunction normalizeUser(decoded: DecodedToken): DecodedToken {\n  const provider =\n    decoded.authProvider ??\n    (decoded as any).AuthProvider ??\n    (decoded as any).provider ??\n    \"Local\";\n\n  const normalizedProvider =\n    typeof provider === \"string\" ? provider.trim() : \"Local\";\n\n  const firstName = decoded.firstName as string | undefined;\n  const lastName = decoded.lastName as string | undefined;\n\n  let fullName = decoded.fullName as string | undefined;\n  if (!fullName && firstName) {\n    fullName = lastName ? `${firstName} ${lastName}` : firstName;\n  }\n\n  return {\n    ...decoded,\n    authProvider: normalizedProvider || \"Local\",\n    fullName,\n  };\n}\n\n/* ======================================================\n   AuthProvider\n====================================================== */\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({\n  children,\n}) => {\n  const [token, setToken] = useState<string | null>(null);\n  const [user, setUser] = useState<DecodedToken | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  /* ------------------------------------------------------\n     Carrega PERMISSÕES do grupo do usuário\n     - Usa userGroupId do token\n     - Chama GET /api/admin/groups/{id}\n     - Extrai modules de group.permissions[].module\n  ------------------------------------------------------- */\n  const loadGroupPermissions = useCallback(\n    async (jwt: string, decoded: DecodedToken) => {\n      try {\n        // Prioriza employeeGroupId (funcionários) sobre userGroupId\n        // Se o usuário tem employeeGroupId, é um funcionário com grupo personalizado\n        const rawGroupId =\n          decoded.employeeGroupId ??\n          decoded.userGroupId ??\n          (decoded as any).user_group_id ??\n          (decoded as any).groupId ??\n          (decoded as any).group_id;\n\n        const userGroupId =\n          typeof rawGroupId === \"number\"\n            ? String(rawGroupId)\n            : (rawGroupId as string | undefined);\n\n        if (!userGroupId) return;\n\n        const res = await fetch(\n          `${API_BASE_URL}/api/admin/groups/${userGroupId}`,\n          {\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: `Bearer ${jwt}`,\n            },\n          }\n        );\n\n        if (!res.ok) {\n          // Se não tiver permissão pra ler o próprio grupo, não quebra o app\n          console.warn(\"Não foi possível carregar permissões do grupo:\", res.status);\n          return;\n        }\n\n        const groupData = await res.json();\n\n        const permissions = Array.isArray(groupData.permissions)\n          ? groupData.permissions\n          : [];\n\n        const modules = permissions\n          .filter((p: any) => p && typeof p.module === \"string\")\n          .map((p: any) => p.module as string);\n\n        setUser((prev) => {\n          if (!prev) return prev;\n          return {\n            ...prev,\n            groupPermissions: permissions,\n            modules,\n          };\n        });\n      } catch (err) {\n        console.error(\"Erro ao carregar permissões do grupo:\", err);\n      }\n    },\n    []\n  );\n\n  /* ------------------------------------------------------\n     Aplica token:\n      - salva no localStorage\n      - decodifica\n      - normaliza\n      - carrega permissões do grupo\n  ------------------------------------------------------- */\n  const applyToken = useCallback(\n    (jwt: string) => {\n      if (typeof window !== \"undefined\") {\n        window.localStorage.setItem(\"memoriza_token\", jwt);\n      }\n\n      const decoded = decodeJwt(jwt);\n      if (decoded) {\n        const normalized = normalizeUser(decoded);\n        setToken(jwt);\n        setUser(normalized);\n\n        // carrega permissões do grupo em background\n        void loadGroupPermissions(jwt, normalized);\n      } else {\n        setToken(null);\n        setUser(null);\n      }\n    },\n    [loadGroupPermissions]\n  );\n\n  // Carrega token do localStorage no primeiro render\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const stored = window.localStorage.getItem(\"memoriza_token\");\n    if (stored) {\n      const decoded = decodeJwt(stored);\n      if (decoded) {\n        const normalized = normalizeUser(decoded);\n        setToken(stored);\n        setUser(normalized);\n\n        void loadGroupPermissions(stored, normalized);\n      }\n    }\n    setIsLoading(false);\n  }, [loadGroupPermissions]);\n\n  // Usado no callback do Google\n  const loginWithToken = useCallback(\n    (jwt: string) => {\n      applyToken(jwt);\n    },\n    [applyToken]\n  );\n\n  /* ======================================================\n     LOGIN NORMAL\n  ====================================================== */\n  const login = useCallback(\n    async (identifier: string, password: string): Promise<LoginResult> => {\n      try {\n        const response = await fetch(`${API_BASE_URL}/api/Auth/login`, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ identifier, password }),\n        });\n\n        const data = await response.json();\n        if (!response.ok || !data?.token) {\n          return {\n            success: false,\n            error:\n              data?.message ||\n              \"Não foi possível fazer login. Tente novamente.\",\n          };\n        }\n\n        applyToken(data.token);\n        return { success: true };\n      } catch (error) {\n        console.error(\"Erro ao fazer login:\", error);\n        return {\n          success: false,\n          error:\n            \"Erro ao conectar ao servidor. Verifique sua conexão e tente novamente.\",\n        };\n      }\n    },\n    [applyToken]\n  );\n\n  /* ======================================================\n     REGISTER NORMAL\n  ====================================================== */\n  const register = useCallback(\n    async (input: {\n      firstName: string;\n      lastName: string;\n      email: string;\n      password: string;\n      confirmPassword: string;\n      phone?: string;\n    }): Promise<RegisterResult> => {\n      try {\n        const response = await fetch(`${API_BASE_URL}/api/Auth/register`, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(input),\n        });\n\n        const data = await response.json();\n        if (!response.ok || !data?.token) {\n          return {\n            success: false,\n            error:\n              data?.message ||\n              \"Não foi possível criar a conta. Verifique os dados e tente novamente.\",\n          };\n        }\n\n        applyToken(data.token);\n        return { success: true };\n      } catch (error) {\n        console.error(\"Erro ao registrar usuário:\", error);\n        return {\n          success: false,\n          error:\n            \"Erro ao conectar ao servidor. Verifique sua conexão e tente novamente.\",\n        };\n      }\n    },\n    [applyToken]\n  );\n\n  /* ======================================================\n     LOGOUT\n  ====================================================== */\n  const logout = useCallback(() => {\n    setToken(null);\n    setUser(null);\n    if (typeof window !== \"undefined\") {\n      window.localStorage.removeItem(\"memoriza_token\");\n    }\n  }, []);\n\n  /* ======================================================\n     Atualiza dados do usuário vindos da página de perfil\n  ====================================================== */\n  const updateUserFromProfile = useCallback(\n    (data: { firstName?: string; lastName?: string; email?: string; phone?: string }) => {\n      setUser((prev) => {\n        if (!prev) return prev;\n\n        const next: DecodedToken = {\n          ...prev,\n          ...data,\n        };\n\n        const fn = (data.firstName ?? prev.firstName) as string | undefined;\n        const ln = (data.lastName ?? prev.lastName) as string | undefined;\n\n        if (fn) {\n          next.fullName = ln ? `${fn} ${ln}` : fn;\n        }\n\n        return next;\n      });\n    },\n    []\n  );\n\n  /* ======================================================\n     ADMIN CHECK (1 = comum, 2 = admin) – legado\n     Agora: isAdmin = pode acessar área admin.\n     Permissões finas = user.modules\n     \n     IMPORTANTE: Funcionários (com employeeGroupId) NÃO são admin,\n     mesmo que tenham permissões para acessar o painel.\n  ====================================================== */\n  const isAdmin =\n    !!user &&\n    (user?.isAdmin === true ||\n      user?.isAdmin === \"true\" ||\n      user?.userGroupId === \"2\") &&\n    !user?.employeeGroupId;  // Funcionários NÃO são admin\n\n  const value = useMemo<AuthContextValue>(\n    () => ({\n      token,\n      user,\n      isAdmin,\n      isLoading,\n      login,\n      register,\n      loginWithToken,\n      logout,\n      updateUserFromProfile,\n    }),\n    [\n      token,\n      user,\n      isAdmin,\n      isLoading,\n      login,\n      register,\n      loginWithToken,\n      logout,\n      updateUserFromProfile,\n    ]\n  );\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n\n// Hook\nexport const useAuth = (): AuthContextValue => {\n  const ctx = useContext(AuthContext);\n  if (!ctx) {\n    throw new Error(\"useAuth deve ser utilizado dentro de um AuthProvider\");\n  }\n  return ctx;\n};"],"names":[],"mappings":";;;;;;AAaE;;AAXF;;;AAFA;;AAYA,MAAM,eACJ,8DAAwC;AA8C1C,MAAM,4BAAc,IAAA,sMAAa,EAA+B;AAEhE;;uDAEuD,GACvD,SAAS,UAAU,KAAa;IAC9B,IAAI;QACF,MAAM,UAAU,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;QACnC,IAAI,CAAC,SAAS,OAAO;QAErB,IAAI,SAAS,QAAQ,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;QAEtD,mBAAmB;QACnB,MAAM,MAAM,OAAO,MAAM,GAAG;QAC5B,IAAI,QAAQ,GAAG,UAAU;aACpB,IAAI,QAAQ,GAAG,UAAU;QAE9B,+BAA+B;QAC/B,MAAM,eAAe,KAAK;QAE1B,yCAAyC;QACzC,MAAM,QAAQ,IAAI,WAAW,aAAa,MAAM;QAChD,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,MAAM,EAAE,IAAK;YAC5C,KAAK,CAAC,EAAE,GAAG,aAAa,UAAU,CAAC;QACrC;QAEA,mBAAmB;QACnB,MAAM,OAAO,IAAI,YAAY,SAAS,MAAM,CAAC;QAC7C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEA;;uDAEuD,GACvD,SAAS,cAAc,OAAqB;IAC1C,MAAM,WACJ,QAAQ,YAAY,IACpB,AAAC,QAAgB,YAAY,IAC7B,AAAC,QAAgB,QAAQ,IACzB;IAEF,MAAM,qBACJ,OAAO,aAAa,WAAW,SAAS,IAAI,KAAK;IAEnD,MAAM,YAAY,QAAQ,SAAS;IACnC,MAAM,WAAW,QAAQ,QAAQ;IAEjC,IAAI,WAAW,QAAQ,QAAQ;IAC/B,IAAI,CAAC,YAAY,WAAW;QAC1B,WAAW,WAAW,GAAG,UAAU,CAAC,EAAE,UAAU,GAAG;IACrD;IAEA,OAAO;QACL,GAAG,OAAO;QACV,cAAc,sBAAsB;QACpC;IACF;AACF;AAKO,MAAM,eAAwD,CAAC,EACpE,QAAQ,EACT;;IACC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iMAAQ,EAAgB;IAClD,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iMAAQ,EAAsB;IACtD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iMAAQ,EAAC;IAE3C;;;;;0DAKwD,GACxD,MAAM,uBAAuB,IAAA,oMAAW;0DACtC,OAAO,KAAa;YAClB,IAAI;gBACF,4DAA4D;gBAC5D,6EAA6E;gBAC7E,MAAM,aACJ,QAAQ,eAAe,IACvB,QAAQ,WAAW,IACnB,AAAC,QAAgB,aAAa,IAC9B,AAAC,QAAgB,OAAO,IACxB,AAAC,QAAgB,QAAQ;gBAE3B,MAAM,cACJ,OAAO,eAAe,WAClB,OAAO,cACN;gBAEP,IAAI,CAAC,aAAa;gBAElB,MAAM,MAAM,MAAM,MAChB,GAAG,aAAa,kBAAkB,EAAE,aAAa,EACjD;oBACE,SAAS;wBACP,gBAAgB;wBAChB,eAAe,CAAC,OAAO,EAAE,KAAK;oBAChC;gBACF;gBAGF,IAAI,CAAC,IAAI,EAAE,EAAE;oBACX,mEAAmE;oBACnE,QAAQ,IAAI,CAAC,kDAAkD,IAAI,MAAM;oBACzE;gBACF;gBAEA,MAAM,YAAY,MAAM,IAAI,IAAI;gBAEhC,MAAM,cAAc,MAAM,OAAO,CAAC,UAAU,WAAW,IACnD,UAAU,WAAW,GACrB,EAAE;gBAEN,MAAM,UAAU,YACb,MAAM;8EAAC,CAAC,IAAW,KAAK,OAAO,EAAE,MAAM,KAAK;6EAC5C,GAAG;8EAAC,CAAC,IAAW,EAAE,MAAM;;gBAE3B;sEAAQ,CAAC;wBACP,IAAI,CAAC,MAAM,OAAO;wBAClB,OAAO;4BACL,GAAG,IAAI;4BACP,kBAAkB;4BAClB;wBACF;oBACF;;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,yCAAyC;YACzD;QACF;yDACA,EAAE;IAGJ;;;;;;0DAMwD,GACxD,MAAM,aAAa,IAAA,oMAAW;gDAC5B,CAAC;YACC,wCAAmC;gBACjC,OAAO,YAAY,CAAC,OAAO,CAAC,kBAAkB;YAChD;YAEA,MAAM,UAAU,UAAU;YAC1B,IAAI,SAAS;gBACX,MAAM,aAAa,cAAc;gBACjC,SAAS;gBACT,QAAQ;gBAER,4CAA4C;gBAC5C,KAAK,qBAAqB,KAAK;YACjC,OAAO;gBACL,SAAS;gBACT,QAAQ;YACV;QACF;+CACA;QAAC;KAAqB;IAGxB,mDAAmD;IACnD,IAAA,kMAAS;kCAAC;YACR;;YAEA,MAAM,SAAS,OAAO,YAAY,CAAC,OAAO,CAAC;YAC3C,IAAI,QAAQ;gBACV,MAAM,UAAU,UAAU;gBAC1B,IAAI,SAAS;oBACX,MAAM,aAAa,cAAc;oBACjC,SAAS;oBACT,QAAQ;oBAER,KAAK,qBAAqB,QAAQ;gBACpC;YACF;YACA,aAAa;QACf;iCAAG;QAAC;KAAqB;IAEzB,8BAA8B;IAC9B,MAAM,iBAAiB,IAAA,oMAAW;oDAChC,CAAC;YACC,WAAW;QACb;mDACA;QAAC;KAAW;IAGd;;yDAEuD,GACvD,MAAM,QAAQ,IAAA,oMAAW;2CACvB,OAAO,YAAoB;YACzB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM,GAAG,aAAa,eAAe,CAAC,EAAE;oBAC7D,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE;wBAAY;oBAAS;gBAC9C;gBAEA,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,OAAO;oBAChC,OAAO;wBACL,SAAS;wBACT,OACE,MAAM,WACN;oBACJ;gBACF;gBAEA,WAAW,KAAK,KAAK;gBACrB,OAAO;oBAAE,SAAS;gBAAK;YACzB,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,wBAAwB;gBACtC,OAAO;oBACL,SAAS;oBACT,OACE;gBACJ;YACF;QACF;0CACA;QAAC;KAAW;IAGd;;yDAEuD,GACvD,MAAM,WAAW,IAAA,oMAAW;8CAC1B,OAAO;YAQL,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM,GAAG,aAAa,kBAAkB,CAAC,EAAE;oBAChE,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;gBACvB;gBAEA,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,OAAO;oBAChC,OAAO;wBACL,SAAS;wBACT,OACE,MAAM,WACN;oBACJ;gBACF;gBAEA,WAAW,KAAK,KAAK;gBACrB,OAAO;oBAAE,SAAS;gBAAK;YACzB,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,8BAA8B;gBAC5C,OAAO;oBACL,SAAS;oBACT,OACE;gBACJ;YACF;QACF;6CACA;QAAC;KAAW;IAGd;;yDAEuD,GACvD,MAAM,SAAS,IAAA,oMAAW;4CAAC;YACzB,SAAS;YACT,QAAQ;YACR,wCAAmC;gBACjC,OAAO,YAAY,CAAC,UAAU,CAAC;YACjC;QACF;2CAAG,EAAE;IAEL;;yDAEuD,GACvD,MAAM,wBAAwB,IAAA,oMAAW;2DACvC,CAAC;YACC;mEAAQ,CAAC;oBACP,IAAI,CAAC,MAAM,OAAO;oBAElB,MAAM,OAAqB;wBACzB,GAAG,IAAI;wBACP,GAAG,IAAI;oBACT;oBAEA,MAAM,KAAM,KAAK,SAAS,IAAI,KAAK,SAAS;oBAC5C,MAAM,KAAM,KAAK,QAAQ,IAAI,KAAK,QAAQ;oBAE1C,IAAI,IAAI;wBACN,KAAK,QAAQ,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,IAAI,GAAG;oBACvC;oBAEA,OAAO;gBACT;;QACF;0DACA,EAAE;IAGJ;;;;;;;yDAOuD,GACvD,MAAM,UACJ,CAAC,CAAC,QACF,CAAC,MAAM,YAAY,QACjB,MAAM,YAAY,UAClB,MAAM,gBAAgB,GAAG,KAC3B,CAAC,MAAM,iBAAkB,6BAA6B;IAExD,MAAM,QAAQ,IAAA,gMAAO;uCACnB,IAAM,CAAC;gBACL;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;YACF,CAAC;sCACD;QACE;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAGH,qBAAO,qNAAC,YAAY,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AAC9C;GA7Ra;KAAA;AAgSN,MAAM,UAAU;;IACrB,MAAM,MAAM,IAAA,mMAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa"}},
    {"offset": {"line": 415, "column": 0}, "map": {"version":3,"sources":["file:///E:/memoriza/codigo-fonte/memoriza-frontend/lib/cart-context.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport {\r\n  createContext,\r\n  useContext,\r\n  useEffect,\r\n  useState,\r\n  type ReactNode,\r\n} from \"react\"\r\n\r\nconst CART_STORAGE_KEY = \"memoriza_cart_v1\"\r\n\r\n// ==== Tipos ====\r\n\r\nexport interface CartItem {\r\n  id: string\r\n  productId: string\r\n  name: string\r\n  imageUrl?: string | null\r\n  price: number\r\n  quantity: number\r\n\r\n  // customização\r\n  sizeId?: number\r\n  sizeName?: string\r\n  colorId?: number\r\n  colorName?: string\r\n  personalizationText?: string\r\n}\r\n\r\ninterface CartContextValue {\r\n  items: CartItem[]\r\n  itemsCount: number\r\n  subtotal: number\r\n  addItem: (item: Omit<CartItem, \"id\"> & { id?: string }) => void\r\n  removeItem: (lineId: string) => void\r\n  /**\r\n   * Atualiza quantidade de um item levando em conta\r\n   * produto + tamanho + cor + texto de personalização\r\n   */\r\n  updateQuantity: (\r\n    productId: string,\r\n    quantity: number,\r\n    sizeId?: number,\r\n    colorId?: number,\r\n    personalizationText?: string,\r\n  ) => void\r\n  clearCart: () => void\r\n}\r\n\r\nconst CartContext = createContext<CartContextValue | undefined>(undefined)\r\n\r\n// ==== Helpers ====\r\n\r\nfunction normalizeNumber(value: unknown): number {\r\n  if (typeof value === \"number\" && !Number.isNaN(value)) return value\r\n  if (typeof value === \"string\") {\r\n    const normalized = value.replace(\",\", \".\")\r\n    const parsed = Number(normalized)\r\n    return Number.isNaN(parsed) ? 0 : parsed\r\n  }\r\n  return 0\r\n}\r\n\r\nfunction loadInitialCart(): CartItem[] {\r\n  if (typeof window === \"undefined\") return []\r\n\r\n  try {\r\n    const raw = window.localStorage.getItem(CART_STORAGE_KEY)\r\n    if (!raw) return []\r\n    const parsed = JSON.parse(raw) as unknown\r\n\r\n    if (!Array.isArray(parsed)) return []\r\n\r\n    // garante que o que vem do storage está coerente\r\n    return parsed.map((item: any): CartItem => ({\r\n      id: String(item.id ?? crypto.randomUUID()),\r\n      productId: String(item.productId ?? \"\"),\r\n      name: String(item.name ?? \"Produto\"),\r\n      imageUrl: item.imageUrl ?? null,\r\n      price: normalizeNumber(item.price),\r\n      quantity:\r\n        typeof item.quantity === \"number\" && item.quantity > 0\r\n          ? item.quantity\r\n          : 1,\r\n      sizeId: typeof item.sizeId === \"number\" ? item.sizeId : undefined,\r\n      sizeName: item.sizeName ?? undefined,\r\n      colorId: typeof item.colorId === \"number\" ? item.colorId : undefined,\r\n      colorName: item.colorName ?? undefined,\r\n      personalizationText: item.personalizationText ?? undefined,\r\n    }))\r\n  } catch {\r\n    return []\r\n  }\r\n}\r\n\r\n// ==== Provider ====\r\n\r\nexport function CartProvider({ children }: { children: ReactNode }) {\r\n  // começa sempre vazio no SSR e no cliente\r\n  const [items, setItems] = useState<CartItem[]>([])\r\n\r\n  // carrega do localStorage só depois que o componente está montado (cliente)\r\n  useEffect(() => {\r\n    const initial = loadInitialCart()\r\n    setItems(initial)\r\n  }, [])\r\n\r\n  // salva no localStorage sempre que mudar\r\n  useEffect(() => {\r\n    if (typeof window === \"undefined\") return\r\n    window.localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(items))\r\n  }, [items])\r\n\r\n  const itemsCount = items.reduce((sum, item) => sum + item.quantity, 0)\r\n  const subtotal = items.reduce(\r\n    (sum, item) => sum + normalizeNumber(item.price) * item.quantity,\r\n    0,\r\n  )\r\n\r\n  const addItem: CartContextValue[\"addItem\"] = (incoming) => {\r\n    const price = normalizeNumber(incoming.price)\r\n\r\n    // chave para considerar o mesmo \"tipo\" de item (produto + tamanho + cor + texto)\r\n    const matchKey = (item: CartItem) =>\r\n      item.productId === incoming.productId &&\r\n      item.sizeId === incoming.sizeId &&\r\n      item.colorId === incoming.colorId &&\r\n      (item.personalizationText ?? \"\") ===\r\n        (incoming.personalizationText ?? \"\")\r\n\r\n    setItems((prev) => {\r\n      const existingIndex = prev.findIndex(matchKey)\r\n\r\n      if (existingIndex >= 0) {\r\n        const updated = [...prev]\r\n        updated[existingIndex] = {\r\n          ...updated[existingIndex],\r\n          quantity: updated[existingIndex].quantity + (incoming.quantity || 1),\r\n          price,\r\n        }\r\n        return updated\r\n      }\r\n\r\n      const lineId = incoming.id ?? crypto.randomUUID()\r\n\r\n      const newItem: CartItem = {\r\n        id: lineId,\r\n        productId: incoming.productId,\r\n        name: incoming.name,\r\n        imageUrl: incoming.imageUrl ?? null,\r\n        price,\r\n        quantity: incoming.quantity > 0 ? incoming.quantity : 1,\r\n        sizeId: incoming.sizeId,\r\n        sizeName: incoming.sizeName,\r\n        colorId: incoming.colorId,\r\n        colorName: incoming.colorName,\r\n        personalizationText: incoming.personalizationText,\r\n      }\r\n\r\n      return [...prev, newItem]\r\n    })\r\n  }\r\n\r\n  const removeItem: CartContextValue[\"removeItem\"] = (lineId) => {\r\n    setItems((prev) => prev.filter((item) => item.id !== lineId))\r\n  }\r\n\r\n  const updateQuantity: CartContextValue[\"updateQuantity\"] = (\r\n    productId,\r\n    quantity,\r\n    sizeId,\r\n    colorId,\r\n    personalizationText,\r\n  ) => {\r\n    const safeQuantity = quantity > 0 ? quantity : 1\r\n\r\n    setItems((prev) =>\r\n      prev.map((item) => {\r\n        const sameProduct = item.productId === productId\r\n        const sameSize = (item.sizeId ?? undefined) === (sizeId ?? undefined)\r\n        const sameColor =\r\n          (item.colorId ?? undefined) === (colorId ?? undefined)\r\n        const sameText =\r\n          (item.personalizationText ?? \"\") ===\r\n          (personalizationText ?? \"\")\r\n\r\n        if (!(sameProduct && sameSize && sameColor && sameText)) {\r\n          return item\r\n        }\r\n\r\n        return {\r\n          ...item,\r\n          quantity: safeQuantity,\r\n        }\r\n      }),\r\n    )\r\n  }\r\n\r\n  const clearCart: CartContextValue[\"clearCart\"] = () => {\r\n    setItems([])\r\n  }\r\n\r\n  return (\r\n    <CartContext.Provider\r\n      value={{\r\n        items,\r\n        itemsCount,\r\n        subtotal,\r\n        addItem,\r\n        removeItem,\r\n        updateQuantity,\r\n        clearCart,\r\n      }}\r\n    >\r\n      {children}\r\n    </CartContext.Provider>\r\n  )\r\n}\r\n\r\n// ==== Hook ====\r\n\r\nexport function useCart(): CartContextValue {\r\n  const ctx = useContext(CartContext)\r\n  if (!ctx) {\r\n    throw new Error(\"useCart must be used within a CartProvider\")\r\n  }\r\n  return ctx\r\n}"],"names":[],"mappings":"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"}}]
}